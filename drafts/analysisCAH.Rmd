---
title: "data CAH"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(readxl)
library(ggpubr)
```

Importing the data into R:
```{r}
Data_set_A <- read_excel("Data set A.xlsx")


Data_set_B <- read_excel("Data set B.xlsx")

```

Throughout this analysis a significance level of 5% will be used.

Turning the distance to work variable into a binary variable that is 1 if the distance is less than 10 miles and 0 if it is more than 10 miles. I therefore also rename the variable from distance_to_work to less than 10 miles (lessthan10mi; 1 = yes, 0 = no)
```{r}
colnames(Data_set_A) <- c('identifier', 'condition', 'lessthan10mi')
Data_set_A$lessthan10mi<- ifelse(Data_set_A$lessthan10mi==">10miles",0,1)
#0 = more than 10 miles
#1 = less than 10 miles 
view(Data_set_A)

```


Filter to view how many people live less or more than 10 miles away:
```{r}
morethan10 <- Data_set_A%>% filter(lessthan10mi=="0")
morethan10

lessthan10 <- Data_set_A%>% filter(lessthan10mi=="1")
lessthan10
```

Merging the two datset with leftjoin, thereby retaining all of the rows from Data set A (the left side) and any matching rows from Data set B. I assume that all those who have not matched did not use the bus. I treat those who tried to use an expired bus pass the same as those who used a valid one. The reasoning behind this is that they were stil trying to use the bus. 


```{r}
merged <- left_join(Data_set_A, Data_set_B, by="identifier") %>% 
  mutate_all(~replace(., is.na(.), 0)) %>% 
  mutate(rode_bus = case_when(rode_bus == "expired" ~ 1, TRUE ~ as.numeric(rode_bus)))

```



Turning the variable 'condition' into a binary variable with 1 for the incentive condition and 0 for the control condition:
```{r}
merged$condition<- ifelse(merged$condition=="incentive",0,1)
# 0 = control
# 1 = incentive
view(merged)
```



I compare the means for the two conditions:

```{r}
merged %>% group_by(condition) %>% summarise(mean = mean(rode_bus),)
```
The higher mean of the control condition suggests that those in the incentive condition were less likely to ride the bus. 

Now that the data is merged I run a logistic regression (assuming that people were randomly assigned to conditions):

```{r}
glmmodel <- glm(rode_bus~factor(condition) + factor(lessthan10mi), family = "binomial", data = merged)

summary_glm<-summary(glmmodel)
summary_glm

```


```{r}
logodds <- c( control = -0.28466,  treatment = -0.28466-0.49827, controlmiless = -0.28466 +  0.01323 , treatmentmiless = -0.28466 +  0.01323-0.49827 )
exp(logodds)/(1+ exp(logodds))
```



```{r}
plot.dat <- data.frame(prob = merged$rode_bus/1003,
                      condition = merged$condition,
                      lessthan10mi = merged$lessthan10mi,
                       fit = predict(glmmodel, merged))

plot.dat$fit_prob <- exp(plot.dat$fit)/(1+exp(plot.dat$fit))

library(ggplot2)
ggplot(plot.dat, aes(x=condition, y=fit_prob, group= lessthan10mi, fill= factor(lessthan10mi))) + 
  geom_point() +
  geom_col(position = "dodge")
```

The intercept is telling me that the likelihood that someone rode the bus is less than 50% (fewer than half the people rode the bus). By being in the Incentive condition the likelihood of riding a bus is  
