---
title: "dataset cleaned"
output: html_notebook
editor_options: 
  markdown: 
    wrap: 72
---

# Launch the Libraries & Clean the Data

```{r}
library(readr)
library(tidyverse)
library(dplyr)
library(cluster)
library(factoextra)
library(psych)
library(corrplot)
```

Clean the data

```{r}
#Import the dataset. Name it as "perstest".
persontest <- read_csv("personality_tests.csv", 
    col_names = FALSE, skip = 3)

#Remove the columns that are irrelevant (everything but the questions). Nothing having to do with personality questions (remove start date, duration etc.)
ptest_useful <- subset (persontest, select = -c(X1, X2, X3, X4, X5, X6, X7, X8, X9, X64, X131:X135))

#Remove the first two rows (mostly responses are NA)
ptest_cut <- ptest_useful[-c(1, 2, 23, 51, 55, 62, 63, 64, 65, 66, 67, 68, 101, 105, 106, 107, 108), ]

#Remove all responses that include 'NA'.
ptest_na<- ptest_cut %>% drop_na() 

#Check
head(ptest_na)
```

Split data sets

```{r}
bigfive <- select(ptest_na, X10:X59)

mbti <- select(ptest_na, X60:X130) 
```

## Question 1

## 1a. What components/factors are present in the data for the tests

**Big Five Factor Analysis**

```{r}
fa.parallel(bigfive, n.obs = NULL, fa = "fa", fm = "minres") 
```

```{r}
EFA_model <- fa(bigfive, nfactors = 5)
fa.diagram(EFA_model)
```

```{r}
# What components are present
EFA_model$loadings
```


**MBTI PCA**

```{r}
#The following shows the correlation of MBTI data
corrplot(cor(mbti), method="number")

#PCA
pr.out <- prcomp(mbti,
                 scale = TRUE,
                 center = TRUE)

summary(pr.out) 

biplot(pr.out) 

fviz_eig(pr.out)

fviz_pca_var(pr.out,
             col.var = "contrib", 
             gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),
             repel = TRUE 
)
```

*MBTI Components* 
MR1 -> Ability to empathize
MR2 -> Pragmaticism/Planning
MR3 -> Order/Preference for what is known
MR4 -> Social bonds

## 1b. What questions seem to map well on these factors/components.

**Big 5**

MR1 -> "I am the life of the party" "Am interested in people," "I feel comfortable around people", "I start conversations", "I have excellent ideas", "I talk to a lot of different people at parties" "I am full of ideas", "I am interested in people", "I seldom feel blue", "I am quick to understand things", "I make people feel at ease", "Keep in the background", "I am easily disturbed", "Have little to say", "Get upset easily", "Do not have a good imagination", "Talk to a lot of different people at parties", "Often feel blue", "Am full of ideas" 

The common underlying characteristics here are being able to be the center of attention or not as well as being able to praise oneself to others. For that reason, this factor mirrors what is explained as extroversion in the Big 5 model.

MR2 -> "Get stressed out easily", "Don't talk a lot", "Am relaxed most of the time", "Worry about things", "Change my mood a lot",  "Have frequent mood swings", "Get irritated easily"

The common underlying characteristic here relates to one's mood and ability to be relaxed, and for that reason we have identified it as neuroticism. 

MR3 -> "Leave my belongings around", "Pay attention to details", "Make a mess of things",  "Get chores done right away", "Often forget to put things back in their proper place",  "Like order"

The common underlying characteristic here is order and ability to be methodical, and for that reason we have identified it as conscientiousness. 

MR4 -> "Feel little concern for others", "Have difficulty understanding abstract ideas", "Sympathize with others' feelings", "Have a soft heart"

Now here is where things start fall apart concerning the factors identified by the Big 5. In this case, these questions don't correlate well with either agreeableness or openness. The underlying characteristic here is adaptability to a given situation, whether that is being able to show concern for others and sympathizing with them, or being able to understand abstract ideas. 

MR5 -> "Have a rich vocabulary", "Am not interested in abstract ideas", "Use difficult words", "Spend time reflecting on things"

Again, the questions associated with this factor cannot be explained using the remaining Big 5 factors. This factor is most likely associated with being a philosophy student and/or spending time thinking about and reading things. 


*MBTI**

MR1 -> "Are you more: Realistic than speculative|Speculative than realistic" , "Are you more impressed by: Principles|Emotions", "In approaching others is your inclination to be somewhat: Objective|Personal", "Which appeals to you more: Consistency of thought|Harmonious human relationships", "Are you more often:A cool-headed person|A warm-hearted person", "Is it worse to be:Unjust|Merciless", "Are you more:Firm than gentle|Gentle than firm", "Are you more likely to:See how others are useful|See how others see", "Are you inclined more to be:Fair-minded|Sympathetic","Which seems the greatest error:to be too passionate|to be too objective", "Do you see yourself as basically: Hard-headed|Soft-hearted"

 Questions coding ability to empathize. All of the above questions contain an emotional component, and specifically relate to decision making in a social environment. For that reason, we believe the underlying shared characteristic here is the ability to empathize with others when the decision affects them or includes them. 

MR2 -> "Are you more interested in:What is actual|What is possible", "In judging others are you more swayed by:Laws than circumstances|Circumstances than laws","Are you more comfortable with work that is:Contracted|Done on a casual basis","Do you tend to look for:The orderly|Whatever turns up", "Do you tend to be more:Deliberate than spontaneous|Spontaneous than deliberate"

 Questions coding pragmaticism/planning. All of these questions aim to distinguish between participants who focus on concrete, pragmatic information, following a specific structure in their decision-making and participants who don’t follow a specific structure, instead showing spontaneity. 

MR3 -> "Do you want things:Settled and decided|Unsettled and undecided", "In phoning do you:Rarely question that it will all be said|Rehearse what you’ll say","In company do you:Initiate conversation|Wait to be approached", "Does new and non-routine interaction with others: Stimulate and energize you|Tax your reserves", "Which is more satisfying:to discuss an issue thoroughly|to arrive at agreement on an issue"

 Questions that focus on order and a preference for what is known. On the one hand, here we see a focus on order in that there is a clear script that needs to be followed with a natural beginning and end point in a situation, where the decision maker knows what to expect. Some questions that might at first seem to be pointing towards characteristics that would suggest introversion, make sense that are also included here because they are pointing to unknown and new situations, where the script of the interaction is not known to the participant. Thus, these questions aim to distinguish between participants who have a clear preference for having a specific order of doing things and knowing what to expect out of any interaction and those who are instead excited by the possibility of something new.

MR4 -> "In your social groups do you:Keep abreast of other’s happenings|Get behind on the news", "Do you:Speak easily and at length with strangers|Find little to say to strangers", "Are you more inclined to be:Easy to approach|Somewhat reserved" 

 Questions that focus on the initiation and strengthening of social bonds. The above questions share the underlying characteristic of focusing on social bonds, and more specifically on one’s ability to both indicate an openness to form a new social bond, initiate that social bond, and maintain that social bond, all through communication.   

## 1c. What questions appear to be the most difficult to map on principal components/factors 

**Big 5** 
X12: "I am always prepared" 
X21: "I insult people" --> doesn't map at all
X24: "I have a vivid imagination" 
X31: "I am not interested in other people's problems" 
X41: "I am not really interested in others" 
X45: "I don't like to draw attention to myself" 
X46: "I take time out for others" 
X47: "I shirk my duties" --> doesn't map at all
X50: "I don't mind being the center of attention" 
X51: "I feel others' emotions" 
X52: "I follow a schedule" 
X55: "I am quiet around strangers" 
X57: "I am exacting in my work"

Apart from the two as indicated above that don't map at all, the rest are weakly associated with their factors, something that we identified based on the degree to which they were correlated with each factor. 

**MBTI**
16. In doing ordinary things are you more likely to:Do it the usual way|Do it your own way
20. Do you feel better about:Having purchased|Having the option to buy
47. Do you value in yourself more that you are:Unwavering|Devoted
66. Is it harder for you to:Identify with others|Utilize others


The above questions seem to not share many similar characteristics to any of the other questions asked by the MBTI, something that was identified by looking at the direction of the vectors. 


## Question 2

First, we perform PCA for Big Five

```{r}
pr.out1 <- prcomp(bigfive,
                 scale = TRUE,
                 center = TRUE)
```

Then, we run the predictions

```{r}
alex_df <- read_csv("alexahpenev_personality.csv")
alex_df %>% select(-Q59) -> alex_df2

alex_df2 %>% select(Q55:Q125) -> alex_df3
alex_df2 %>% select(Q1:Q54) -> alex_df4

names(alex_df3) <- names(mbti)
names(alex_df4) <- names(bigfive)
#names(alex_df2) <-  gsub('Q', 'X', names(alex_df2))

predict(pr.out, alex_df3) -> alex_mbti
predict(pr.out1, alex_df4) -> alex_bigfive

pca_big5 <- as.data.frame(pr.out1$x) 
pca_big5 %>% select(PC1) %>% filter(PC1 < 5.101907)
pca_big5 %>% select(PC1)
View(pca_big5)
```


## Question 3 - Clustering of respondents based on the MBTI. 

We will use hierarchical clustering since we do not have a predefined number of clusters, because we are talking about personalities traits. Also, we have a small data set which facilitates the application of hierarchical clustering.

```{r}
#We select the principal components after 
pr.outX<-data.frame(pr.out$x)
mbticlust <- pr.outX %>% select(PC1,PC2,PC3,PC4)

# We won't scale since all the questions were measured a-b (represented by 1-2), so we assumed they weight equally.
# Calculate distances. We used complete linkage to obtain a more balanced tree.
clustering <- hclust(dist(mbticlust), method = 'complete')
cutree(clustering, k = 4)
plot(hclust(distm, method = 'complete'))

#Clustering
mbticlust%>%
  mutate(cluster = cutree(clustering, k = 4)) %>% 
  group_by(cluster) %>% 
  summarise_all(funs(median(.)))
```

*Does it appear that certain personality traits are more influential for clustering than others?*
The most influential personality trait for clustering is "the ability to empathize" (PC1).











